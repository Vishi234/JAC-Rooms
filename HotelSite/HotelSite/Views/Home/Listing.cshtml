
@{
    ViewBag.Title = "Listing";
    Layout = "~/Views/_CommonLayout.cshtml";
}

<div class="loading-bar">
    <div class="progress"></div>
    <div class="content">
        Finding the best stays for you
    </div>
</div>
<div class="container listingBase">
    <div class="listing-body">
        <div class="row">
            <div class="search-modification">
                <div class="triangle-with-shadow"></div>
                <div class="search-area">
                    <div class="search-base hotelBase">
                        <form class="form-inline" action="@Url.Action("Listing","Home")" method="get">
                            <div class="form-fields">
                                <div class="form-group">
                                    <input type="text" name="Keyword" value="@Request.QueryString["Keyword"]" autocomplete="off" class="searchBox form-control" placeholder="Search Location and City in India" required>
                                    @*<label class="form-control-placeholder" for="seachBox">Select City, Location in India</label>*@
                                    <i class="fa fa-map-marker icon mapIcon"></i>
                                    <div class="search_field">
                                        <div class="triangle-with-shadow">
                                        </div>
                                        <div class="search_box" id="search_box">

                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="text" id="checkin" value="@Request.QueryString["CheckIn"]" name="CheckIn" class="checkinDate datePicker form-control" placeholder="Check-in" required>
                                    <label class="form-control-placeholder" for="checkin">Check-in</label>
                                    <i class="fa fa-calendar icon"></i>
                                    <div class="cal_base">
                                        <div class="calendar">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="text" id="checkout" name="CheckOut" value="@Request.QueryString["CheckOut"]" class="checkoutDate datePicker form-control" placeholder="Check-out" required>
                                    <label class="form-control-placeholder" for="checkout">Check-out</label>
                                    <i class="fa fa-calendar icon"></i>
                                </div>
                                <div class="form-group rooMHover">
                                    <input type="text" id="room" readonly class="form-control room_val" name="Person" value="@Request.QueryString["Person"]" required>
                                    <label class="form-control-placeholder" for="room"></label>
                                    <img src="~/Content/images/sort-down.svg" class="img-icon" />
                                </div>
                                <div class="form-group">
                                    <input type="submit" class="searchBtn btn btn-danger" value="Search" />
                                    @*<a href="javascript:void(0)" class="searchBtn btn btn-danger">Search</a>*@
                                </div>
                            </div>
                        </form>

                    </div>
                    <div class="nav-drop roomDetails">
                        <div class="triangle-with-shadow">
                        </div>
                        <div class="nav-list">
                            <div class="room_base"></div>
                            <div class="ButtonGroup">
                                <a href="javascript:void(0)" onclick="addRoom(1);" class="pull-left btn btn-light">Add Room</a>
                                <a href="javascript:void(0)" class="pull-right btn btn-danger saveRoom">Done</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-3 col-xs-12 col-sm-3 col-md-3">
                <div class="row">
                    <div class="listing-filter">
                        <div class="location-filter filter-style">
                            <h5>Location<a href="javascript:void" class="reset-filter pull-right" onclick="clearLocationFilter(this)">Reset</a></h5>
                            <input type="text" onkeyup="LocationFilterKeyPress(this.value, 'locationData');" class="form-control locationFilter" placeholder="Seach by location" />
                            <div class="searchBase" id="locationFilter">
                                <div class="triangle-with-shadow">
                                </div>
                                <div class="search_box" id="locationData">

                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="hotelname-filter filter-style">
                            <h5>Seach By Hotel Name </h5>
                            <input type="text" onkeyup="HotelNameFilter(this.value, 'hotelData');" class="form-control" placeholder="Hotel Name" />
                            <div class="searchBase" id="hotelFilter">
                                <div class="triangle-with-shadow">
                                </div>
                                <div class="search_box" id="hotelData">

                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="hoteltype-filter filter-style">
                            <h5>Hotel Type<a href="javascript:void" class="reset-filter pull-right" onclick="clearHotelType(this)">Reset</a></h5>
                            <input id="type1" class="chkr" value="Resort" type="checkbox" />
                            <label for="type1">Resort</label>
                            <input id="type2" class="chkr" value="Hotel" type="checkbox" />
                            <label for="type2">Hotel</label>
                            <input id="type3" class="chkr" value="Motel" type="checkbox" />
                            <label for="type3">Motel</label>
                            <input id="type4" class="chkr" value="BnB" type="checkbox" />
                            <label for="type4">BnB</label>
                            <input id="type5" class="chkr" value="Homestay" type="checkbox" />
                            <label for="type5">Homestay</label>
                            <input id="type6" class="chkr" value="Tent" type="checkbox" />
                            <label for="type6">Tent</label>
                            <input id="type7" class="chkr" value="Appartment" type="checkbox" />
                            <label for="type7">Appartment</label>
                            <input id="type8" class="chkr" value="Bungalow" type="checkbox" />
                            <label for="type8">Bungalow</label>
                            <input id="type9" class="chkr" value="Loadge" type="checkbox" />
                            <label for="type9">Loadge</label>
                            <input id="type10" class="chkr" value="GuestHouse" type="checkbox" />
                            <label for="type10">GuestHouse</label>
                            <input id="type11" class="chkr" value="Hostel" type="checkbox" />
                            <label for="type11">Hostel</label>
                            <input id="type12" class="chkr" value="Cattage" type="checkbox" />
                            <label for="type12">Cattage</label>
                            <input id="type13" class="chkr" value="Houseboat" type="checkbox" />
                            <label for="type14">Houseboat</label>
                            <input id="type15" class="chkr" value="Villa" type="checkbox" />
                            <label for="type15">Villa</label>
                            <input id="type16" class="chkr" value="Palace" type="checkbox" />
                            <label for="type16">Palace</label>
                            <input id="type17" class="chkr" value="BeachHut" type="checkbox" />
                            <label for="type17">BeachHut</label>

                        </div>
                        <hr />
                        <div class="smart-filter filter-style">
                            <h5>Smart Filter <a href="javascript:void" class="reset-filter pull-right">Reset</a></h5>
                            <input id="box1" type="checkbox" />
                            <label for="box1">Pay At Checkout</label>
                            <input id="box2" type="checkbox" />
                            <label for="box2">Free Cancellation</label>
                        </div>
                        <hr />
                        <div class="price-filter filter-style">
                            <h5>Price Range <a href="javascript:void" class="reset-filter pull-right">Reset</a></h5>
                            <input id="price1" type="checkbox" />
                            <label for="price1">Upto <i class="fa fa-rupee"></i> 999</label>
                            <input id="price2" type="checkbox" />
                            <label for="price2"><i class="fa fa-rupee"></i> 1000 to <i class="fa fa-rupee"></i> 3000</label>
                            <input id="price3" type="checkbox" />
                            <label for="price3"><i class="fa fa-rupee"></i> 3000 to <i class="fa fa-rupee"></i> 5000</label>
                            <input id="price4" type="checkbox" />
                            <label for="price4"><i class="fa fa-rupee"></i> 5000 to <i class="fa fa-rupee"></i> 10000</label>
                            <input id="price5" type="checkbox" />
                            <label for="price5"><i class="fa fa-rupee"></i> 10000 +</label>
                        </div>
                        <hr />

                    </div>
                </div>
            </div>
            <div class="col-lg-9 col-xs-12 col-sm-9 col-md-9">
                <div class="row">
                    <div class="loadingBase2">
                        <img src="~/Content/images/loadingIcon.gif" />
                    </div>
                    <div class="hotelNewList" id="hotelList">
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/scripts/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
<script type="text/javascript">
    var count = 0;
    var filterData;
    var a = moment("@Request.QueryString["CheckIn"]", 'DD-MMM-YYYY');
    var b = moment("@Request.QueryString["CheckOut"]", 'DD-MMM-YYYY');
    var days = b.diff(a, 'days');
    var keyword;
    var selected = [];
    var hotelData;
    $(document).ready(function () {
        GetSeachData();
        filterData = GetCacheHotelData("");

    });
    $(".chkr").change(function () {
        selected = [];
        $('.hoteltype-filter input:checked').each(function () {
            if ($(this).is(":checked")) {
                selected.push($(this).val());
            }
        });
        filter();
    });
    function clearLocationFilter(e) {
        $(".locationFilter").val("");
        filter();
    }
    function clearHotelType(e) {
        selected = [];
        $('.hoteltype-filter input:checked').each(function () {
            $(this).removeAttr('checked');
        });
        filter();
    }
    function HotelNameSelect(e) {
        window.location.href = '/Home/HotelDescription?keyword=@Request.QueryString["Keyword"]&CheckIn=@Request.QueryString["CheckIn"]&CheckOut=@Request.QueryString["CheckOut"]&Person=@Request.QueryString["Person"]&ID=' + e.getAttribute("HotelID");
    }
    function filterListing(e) {
        $("#locationFilter").css("display", "none");
        $("#locationData").css("display", "none");
        $(".locationFilter").val(e.text);
        filter();
    }
    function filter() {
        $(".loadingBase2").css('display', 'block')
        var data = getJsonData('../../Location Data/GlobalData.json');
        setTimeout(function () {
            if ($(".locationFilter").val() != "") {
                hotelData = $.grep(data.Hotels, function (item, i) {
                    return ((item.StreetAddress.toLocaleLowerCase().indexOf($(".locationFilter").val().toLocaleLowerCase()) > 0) ? item.HotelName : "");
                });
                $("#hotelList").empty();
                createListing(hotelData);
            }
            if (selected.length > 0) {
                $("#hotelList").empty();
                for (var i = 0; i < selected.length; i++) {
                    if (selected[i] != "") {
                        keyword = selected[i];
                        hotelData = $.grep(((hotelData == undefined || hotelData == "") ? data.Hotels : hotelData), function (item, i) {
                            return (((item.HotelType.toLocaleLowerCase()).indexOf(keyword.toLocaleLowerCase()) > 0) ? item : "");
                        });

                        if (hotelData != "") {
                            createListing(hotelData);
                        }

                    }
                }
            }
            if ($(".locationFilter").val() == "" && selected.length == 0) {
                $("#hotelList").empty();
                GetSeachData();
            }
            $(".loadingBase2").css('display', 'none');
        }, 3000)

    }

    function createListing(hotelData) {
        var data = getJsonData('../../Location Data/GlobalData.json');
        var html = "<ul>";
        var hotelPrice = 0;
        var hotelPic = "";
        var src = "";

        $.each(hotelData, function (i, item) {
            $.each(data.Rooms, function (j, val) {
                if (item.HotelID == val.HotelID) {
                    hotelPrice = val.PricePerNight;
                }
            });
            $.each(data.Pics, function (k, picVal) {
                if (item.HotelID == picVal.HotelID) {
                    if (picVal.PicName != "") {
                        hotelPic = picVal.PicName;
                        return;
                    }
                }
            });
            src = "";
            if (hotelPic != "") {
                src = "@System.Configuration.ConfigurationManager.AppSettings["GetImageUrl"]@System.Configuration.ConfigurationManager.AppSettings["FolderName"]/";
                src += item.hoteldisplayname + "~" + item.hotelid + "/" + hotelPic;
                // src = '"' + src + '"';
            }
            var style = "background:url('" + src + "')repeat center;";

            html += '<li><div class="hotelNewImg"><img src="' + src + '" /></div><div class="hotelNewDes">';
            html += '<div class="hotelNewDesLeft"><a href="/Home/HotelDescription?keyword=@Request.QueryString["Keyword"]&CheckIn=@Request.QueryString["CheckIn"]&CheckOut=@Request.QueryString["CheckOut"]&Person=@Request.QueryString["Person"]&ID=' + item.HotelID + '" class="hotelname"><h2>' + item.HotelDisplayName + '</h2></a><p class="add"><i class="fa fa-map-marker"></i>' + item.StreetAddress + '</p>';
            html += '</div><div class="hotelNewDesRight"><p class="night">For <span>' + days + '</span> nights</p> <span class="priceNew"><i class="fa fa-rupee"></i> <span>' + ((parseInt(days) > 0) ? parseInt(hotelPrice * days) : hotelPrice) + '</span></span>';
            html += '<a href="/Home/HotelDescription?keyword=@Request.QueryString["Keyword"]&CheckIn=@Request.QueryString["CheckIn"]&CheckOut=@Request.QueryString["CheckOut"]&Person=@Request.QueryString["Person"]&ID=' + item.HotelID + '" class="hbtn">Choose Room</a></div></div></li>'

            html += "</ul>";
            $("#hotelList").append(html);
        });
    }
    function GetSeachData() {

        var SearchKeyword =
            {
                Keyword: "@Request.QueryString["Keyword"]",
                CheckIn: "@Request.QueryString["CheckIn"]",
                CheckOut: "@Request.QueryString["CheckOut"]",
            };

        $.ajax({
            type: 'POST',
            url: "@Url.Action("GetSearchData", "Home")",
            contentType: "application/json",
            async: false,
            data: JSON.stringify({ Search: SearchKeyword }),
            success: function (data) {
                var jsonData = JSON.parse(data);
                var html = "<ul>";
                var hotelPrice = 0;
                var hotelPic = "";
                var src = "";
                $.each(jsonData["HotelName"], function (i, item) {

                    $.each(jsonData["HotelPrice"], function (j, val) {
                        if (item.hotelid == val.hotelid) {
                            hotelPrice = val.pricepernight;
                        }
                    });
                    $.each(jsonData["HotelPics"], function (k, picVal) {
                        if (item.hotelid == picVal.hotelid) {
                            if (picVal.picname != "") {
                                hotelPic = picVal.picname;
                                return;
                            }
                        }
                    });
                    src = "";
                    if (hotelPic != "") {
                        src = "@System.Configuration.ConfigurationManager.AppSettings["GetImageUrl"]@System.Configuration.ConfigurationManager.AppSettings["FolderName"]/";
                        src += item.hoteldisplayname + "~" + item.hotelid + "/" + hotelPic;
                        // src = '"' + src + '"';
                    }
                    var style = "background:url('" + src + "')repeat center;";

                    html += '<li><div class="hotelNewImg"><img src="' + src + '" /></div><div class="hotelNewDes">';
                    html += '<div class="hotelNewDesLeft"><a href="/Home/HotelDescription?keyword=@Request.QueryString["Keyword"]&CheckIn=@Request.QueryString["CheckIn"]&CheckOut=@Request.QueryString["CheckOut"]&Person=@Request.QueryString["Person"]&ID=' + item.hotelid + '" class="hotelname"><h2>' + item.hoteldisplayname + '</h2></a><p class="add"><i class="fa fa-map-marker"></i>' + item.streetaddress + '</p>';
                    html += '</div><div class="hotelNewDesRight"><p class="night">For <span>' + days + '</span> nights</p> <span class="priceNew"><i class="fa fa-rupee"></i> <span>' + ((parseInt(days) > 0) ? parseInt(hotelPrice * days) : hotelPrice) + '</span></span>';
                    html += '<a href="/Home/HotelDescription?keyword=@Request.QueryString["Keyword"]&CheckIn=@Request.QueryString["CheckIn"]&CheckOut=@Request.QueryString["CheckOut"]&Person=@Request.QueryString["Person"]&ID=' + item.hotelid + '" class="hbtn">Choose Room</a></div></div></li>'
                })
                html += "</ul>";
                $("#hotelList").append(html);
            },
            error: function (error) {

            }

        });

    }
</script>